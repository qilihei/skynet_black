# å†œåœºæ¸¸æˆå®¢æˆ·ç«¯å¼€å‘æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºCocos Creator 3.8å’ŒTypeScriptå¼€å‘çš„å†œåœºæ¸¸æˆå®¢æˆ·ç«¯ï¼Œæ”¯æŒä¸æœåŠ¡å™¨çš„å®æ—¶é€šä¿¡å’Œå®Œæ•´çš„æ¸¸æˆåŠŸèƒ½ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
client/
â”œâ”€â”€ assets/                 # æ¸¸æˆèµ„æº
â”‚   â”œâ”€â”€ scenes/            # åœºæ™¯æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ LoginScene.scene
â”‚   â”‚   â””â”€â”€ GameScene.scene
â”‚   â”œâ”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ managers/      # ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ network/       # ç½‘ç»œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ scenes/        # åœºæ™¯è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ ui/           # UIç»„ä»¶
â”‚   â”‚   â””â”€â”€ protocol/      # åè®®æ–‡ä»¶(è‡ªåŠ¨ç”Ÿæˆ)
â”‚   â”œâ”€â”€ textures/          # è´´å›¾èµ„æº
â”‚   â””â”€â”€ prefabs/           # é¢„åˆ¶ä½“
â”œâ”€â”€ protocol/              # åè®®å®šä¹‰
â”œâ”€â”€ scripts/               # æ„å»ºè„šæœ¬
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â””â”€â”€ package.json           # é¡¹ç›®é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

**å¿…éœ€è½¯ä»¶**:
- Cocos Creator 3.8+
- Node.js 16+
- TypeScript 4.5+

**å®‰è£…ä¾èµ–**:
```bash
cd client
npm install
```

### 2. ç”Ÿæˆåè®®ä»£ç 

```bash
npm run generate-proto
```

### 3. æ‰“å¼€é¡¹ç›®

1. å¯åŠ¨Cocos Creator
2. æ‰“å¼€clientæ–‡ä»¶å¤¹ä½œä¸ºé¡¹ç›®
3. ç­‰å¾…é¡¹ç›®åŠ è½½å®Œæˆ

### 4. è¿è¡Œé¡¹ç›®

1. åœ¨Cocos Creatorä¸­ç‚¹å‡»"é¢„è§ˆ"æŒ‰é’®
2. æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ: `npm run preview`

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### ç½‘ç»œç®¡ç†å™¨ (NetworkManager)

è´Ÿè´£ä¸æœåŠ¡å™¨çš„WebSocketè¿æ¥å’Œåè®®é€šä¿¡ã€‚

**ä¸»è¦åŠŸèƒ½**:
- WebSocketè¿æ¥ç®¡ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- å¿ƒè·³æ£€æµ‹
- æ¶ˆæ¯é˜Ÿåˆ—
- åè®®ç¼–ç /è§£ç 

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const networkManager = NetworkManager.getInstance();

// è¿æ¥æœåŠ¡å™¨
await networkManager.connect();

// å‘é€æ¶ˆæ¯
const loginData = protocolManager.encodeLoginRequest(username, password);
const response = await networkManager.sendRequest(100, loginData);
```

### åè®®ç®¡ç†å™¨ (ProtocolManager)

å¤„ç†Protocol Buffersåè®®çš„ç¼–ç å’Œè§£ç ã€‚

**ä¸»è¦åŠŸèƒ½**:
- åè®®æ¶ˆæ¯ç¼–ç /è§£ç 
- å‘½ä»¤IDæ˜ å°„
- æ¶ˆæ¯åŒ…è£…å™¨å¤„ç†

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const protocolManager = ProtocolManager.getInstance();

// ç¼–ç ç™»å½•è¯·æ±‚
const loginData = protocolManager.encodeLoginRequest(username, password);

// è§£ç ç™»å½•å“åº”
const loginResponse = protocolManager.decodeLoginResponse(responseData);
```

### äº‹ä»¶ç®¡ç†å™¨ (EventManager)

æä¾›å…¨å±€äº‹ä»¶ç³»ç»Ÿï¼Œæ”¯æŒç»„ä»¶é—´é€šä¿¡ã€‚

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const eventManager = EventManager.getInstance();

// æ³¨å†Œäº‹ä»¶ç›‘å¬
eventManager.on('player_data_updated', this.onPlayerDataUpdated, this);

// è§¦å‘äº‹ä»¶
eventManager.emit('player_data_updated', playerData);

// ç§»é™¤ç›‘å¬
eventManager.off('player_data_updated', this.onPlayerDataUpdated);
```

### æ¸¸æˆæ•°æ®ç®¡ç†å™¨ (GameDataManager)

ç®¡ç†æ¸¸æˆè¿è¡Œæ—¶æ•°æ®å’Œæœ¬åœ°å­˜å‚¨ã€‚

**ä¸»è¦åŠŸèƒ½**:
- ç©å®¶æ•°æ®ç®¡ç†
- å†œåœºæ•°æ®ç®¡ç†
- èƒŒåŒ…æ•°æ®ç®¡ç†
- æœ¬åœ°å­˜å‚¨

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const gameDataManager = GameDataManager.getInstance();

// è®¾ç½®ç©å®¶æ•°æ®
gameDataManager.setPlayerData(playerInfo);

// è·å–ç©å®¶æ•°æ®
const playerData = gameDataManager.getPlayerData();

// æ›´æ–°ç©å®¶é‡‘å¸
gameDataManager.updatePlayerGold(newGoldAmount);
```

### åœºæ™¯ç®¡ç†å™¨ (SceneManager)

ç®¡ç†åœºæ™¯åˆ‡æ¢å’ŒåŠ è½½ã€‚

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const sceneManager = SceneManager.getInstance();

// åˆ‡æ¢åˆ°æ¸¸æˆåœºæ™¯
await sceneManager.gotoGameScene();

// é¢„åŠ è½½åœºæ™¯
await sceneManager.preloadScene(SceneName.GAME);
```

### UIç®¡ç†å™¨ (UIManager)

ç®¡ç†UIç•Œé¢çš„æ˜¾ç¤ºã€éšè—å’Œå±‚çº§ã€‚

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const uiManager = UIManager.getInstance();

// æ³¨å†ŒUIé…ç½®
uiManager.registerUI('LoginPanel', {
    prefab: loginPanelPrefab,
    layer: UILayer.NORMAL,
    singleton: true,
    cache: true
});

// æ˜¾ç¤ºUI
await uiManager.showUI('LoginPanel', { username: 'player' });

// éšè—UI
uiManager.hideUI('LoginPanel');
```

## ğŸ® æ¸¸æˆæµç¨‹

### 1. åº”ç”¨å¯åŠ¨

1. `GameApp`ç»„ä»¶åˆå§‹åŒ–
2. åŠ è½½æœ¬åœ°æ•°æ®
3. åˆå§‹åŒ–å„ä¸ªç®¡ç†å™¨
4. è¿›å…¥ç™»å½•åœºæ™¯

### 2. ç™»å½•æµç¨‹

1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
2. è¿æ¥æœåŠ¡å™¨
3. å‘é€ç™»å½•è¯·æ±‚
4. æ¥æ”¶ç™»å½•å“åº”
5. ä¿å­˜ç©å®¶æ•°æ®
6. è¿›å…¥æ¸¸æˆåœºæ™¯

### 3. æ¸¸æˆåœºæ™¯

1. æ˜¾ç¤ºç©å®¶ä¿¡æ¯
2. åŠ è½½å†œåœºæ•°æ®
3. å¤„ç†ç”¨æˆ·äº¤äº’
4. ä¸æœåŠ¡å™¨åŒæ­¥æ•°æ®

## ğŸ“¡ ç½‘ç»œåè®®

### åè®®æ ¼å¼

ä½¿ç”¨Protocol Buffersæ ¼å¼ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½åŒ…è£…åœ¨`MessageWrapper`ä¸­ï¼š

```protobuf
message MessageWrapper {
    uint32 cmd = 1;           // å‘½ä»¤ID
    uint32 seq = 2;           // åºåˆ—å·
    uint64 timestamp = 3;     // æ—¶é—´æˆ³
    bytes data = 4;           // æ¶ˆæ¯æ•°æ®
}
```

### ä¸»è¦åè®®

| å‘½ä»¤ID | åè®®åç§° | è¯´æ˜ |
|--------|----------|------|
| 0 | CMD_HEARTBEAT | å¿ƒè·³æ£€æµ‹ |
| 100 | CMD_LOGIN_REQUEST | ç™»å½•è¯·æ±‚ |
| 200 | CMD_PLAYER_GET_INFO | è·å–ç©å®¶ä¿¡æ¯ |
| 300 | CMD_FARM_GET_INFO | è·å–å†œåœºä¿¡æ¯ |

### æ·»åŠ æ–°åè®®

1. åœ¨`protocol/game.proto`ä¸­å®šä¹‰æ–°æ¶ˆæ¯
2. è¿è¡Œ`npm run generate-proto`ç”Ÿæˆä»£ç 
3. åœ¨`ProtocolManager`ä¸­æ·»åŠ ç¼–ç /è§£ç æ–¹æ³•
4. åœ¨ç›¸åº”çš„åœºæ™¯æˆ–ç»„ä»¶ä¸­å¤„ç†åè®®

## ğŸ¨ UIå¼€å‘

### UIå±‚çº§

- `BACKGROUND`: èƒŒæ™¯å±‚
- `NORMAL`: æ™®é€šUIå±‚
- `POPUP`: å¼¹çª—å±‚
- `SYSTEM`: ç³»ç»ŸUIå±‚
- `TOP`: é¡¶å±‚UI

### åˆ›å»ºæ–°UI

1. åœ¨Cocos Creatorä¸­åˆ›å»ºé¢„åˆ¶ä½“
2. ç¼–å†™UIè„šæœ¬ç»§æ‰¿`Component`
3. æ³¨å†ŒUIé…ç½®åˆ°`UIManager`
4. ä½¿ç”¨`UIManager`æ˜¾ç¤º/éšè—UI

## ğŸ”¨ æ„å»ºå’Œå‘å¸ƒ

### å¼€å‘æ„å»º

```bash
# Webå¹³å°
npm run build web

# Androidå¹³å°
npm run build android

# iOSå¹³å°
npm run build ios
```

### è°ƒè¯•æ„å»º

```bash
npm run build web --debug
```

### æ„å»ºé…ç½®

åœ¨`scripts/build.js`ä¸­å¯ä»¥ä¿®æ”¹æ„å»ºé…ç½®ï¼š

- è¾“å‡ºç›®å½•
- å¹³å°ç‰¹å®šé€‰é¡¹
- èµ„æºå¤„ç†
- ç‰ˆæœ¬ä¿¡æ¯

## ğŸ› è°ƒè¯•å’Œæµ‹è¯•

### æ—¥å¿—ç³»ç»Ÿ

ä½¿ç”¨`console.log`è¿›è¡Œè°ƒè¯•ï¼Œæ”¯æŒä¸åŒçº§åˆ«ï¼š

```typescript
console.log('Info message');
console.warn('Warning message');
console.error('Error message');
```

### ç½‘ç»œè°ƒè¯•

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹WebSocketè¿æ¥ï¼š

1. æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. ç­›é€‰WSè¿æ¥
4. æŸ¥çœ‹æ¶ˆæ¯æ”¶å‘

### æ€§èƒ½åˆ†æ

ä½¿ç”¨Cocos Creatorå†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·ï¼š

1. åœ¨é¢„è§ˆçª—å£ç‚¹å‡»"è°ƒè¯•"æŒ‰é’®
2. æŸ¥çœ‹FPSã€å†…å­˜ä½¿ç”¨ç­‰ä¿¡æ¯

## ğŸ“š æœ€ä½³å®è·µ

### ä»£ç è§„èŒƒ

1. ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
2. éµå¾ªé©¼å³°å‘½åè§„èŒƒ
3. æ·»åŠ é€‚å½“çš„æ³¨é‡Š
4. ä½¿ç”¨ESLintæ£€æŸ¥ä»£ç è´¨é‡

### æ€§èƒ½ä¼˜åŒ–

1. åˆç†ä½¿ç”¨å¯¹è±¡æ± 
2. åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº
3. é¿å…é¢‘ç¹çš„DOMæ“ä½œ
4. ä½¿ç”¨çº¹ç†å‹ç¼©

### é”™è¯¯å¤„ç†

1. ä½¿ç”¨try-catchå¤„ç†å¼‚å¸¸
2. ç½‘ç»œè¯·æ±‚æ·»åŠ è¶…æ—¶å¤„ç†
3. æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### èµ„æºç®¡ç†

1. æŒ‰éœ€åŠ è½½èµ„æº
2. åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº
3. ä½¿ç”¨èµ„æºé¢„åŠ è½½æå‡ä½“éªŒ

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### çƒ­æ›´æ–°

æ”¯æŒèµ„æºçƒ­æ›´æ–°ï¼Œæ— éœ€é‡æ–°ä¸‹è½½æ•´ä¸ªåº”ç”¨ï¼š

1. é…ç½®çƒ­æ›´æ–°æœåŠ¡å™¨
2. æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°
3. ä¸‹è½½å·®å¼‚èµ„æº
4. é‡å¯åº”ç”¨

### ç‰ˆæœ¬ç®¡ç†

ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼š`ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬`

- ä¸»ç‰ˆæœ¬ï¼šä¸å…¼å®¹çš„APIä¿®æ”¹
- æ¬¡ç‰ˆæœ¬ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- ä¿®è®¢ç‰ˆæœ¬ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. [Cocos Creatorå®˜æ–¹æ–‡æ¡£](https://docs.cocos.com/)
2. [TypeScriptå®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/docs/)
3. [Protocol Buffersæ–‡æ¡£](https://developers.google.com/protocol-buffers)

---

ç¥ä½ å¼€å‘æ„‰å¿«ï¼ğŸ®
